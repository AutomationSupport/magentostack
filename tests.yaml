test-cases:
- name: Check Basic Deployment
  inputs: &inputs
    blueprint:
      url: http://magento.cldsrvr.com/
      version: 1.7.0.2
      region: IAD
      sampledata: false
      username: "MagentoAdmin"
      password: "Mag!345678"
      encryption_key: 3fdsk3Ajf77aFEDS
      email: "chkmate@example.com"
      magento_server_count: 3
      firstname: "Test"
      lastname: "Deployment"
      chef-server-url: https://api.chef.io/organizations/cloudtest
      chef-server-username: chefuser
      install_method: git
      git_repo: git@github.com:doesnotexist/enterprise-magento.git
      install_flavor: enterprise
      php_version: php54
      validator-username: chef-validator
      validator-pem: &rsakey |
        -----BEGIN RSA PRIVATE KEY-----
        MIIEogIBAAKCAQEAxwIcCc5+5iZM1KRJ4HnEhyX8SPAbT4AffqbsmSbSHKQGGCR4
        FwAIO9uhcCPavlcnpuNEAKZt+yE96OwQQBz9OMl0JMMrKhJ9yBJUhxADZezAu41O
        phOGfAo9Lhj26GhV/yKmroNBglVHJknw4XCgdYOd5W/7q4QGFIbRv22bKeXdcbLm
        8cRfbKugAVBG5AqzIoraRdiSoCCOP4VEE9pjo/SmDc2egbrorHRV5PEsZoYwXBDW
        Sh19bHnIxRY8SnpsEzAjiSLqf0AnuiPgJNTkylLpxxgIsazJb+bQ1sDcQWFJ3WJN
        JS6rKH2WM8uTHYpTw0k1WnaveV3z6Ju29cgsdQIDAQABAoIBACtrh2iQWFmow5yl
        l8TVbI68N/ZGBP9sifKdQwQLV06ObxH3awhBpopA2lFYUVK0O1+LOHwX0+k2EIbw
        cn86k/k+4wteVd2hGTZ84VpyoPstE8QYCa/slKwdo8maAs0kbpbzHYD3/GQObS6q
        dVcKtsfNBrdXnoaGkLkLzVnB9VfHfzV8uqbfDZSU7hGOA8Ebdemp02MBomdPacdm
        nn2MXT4SSHgcANpda0HgSpQlUdXeeQ3pYE57A2iFOQfsIBwJnrGd/oMehsTJBUPH
        f4TM0P86Cei248QfJbhjBSYRHmzbqfMzoTHH2gETgUdCoxENpwuCGG8aQeCX7Jie
        fzotE+ECgYEA/wl5lUQuEV30WfW5Ln73CHmpUuDx7TZO0HSJrzltd+9N/ya7Hhg5
        Hr/0of9j6tmABTrWafABay0wxyq1Hy0letG0+Y2HD1VYmXfi1PjdSzRVbyLyi8ph
        E2GCIBdfvKVo5QPJnn5j3wN2GnK6PxHtTQ64x4YERRybBNn7U9ENPr0CgYEAx8J5
        ze854TYvBHl6v656CaJ+gSqyYQFyMInuyFKGFCQ7sAtRbrwk2/cR5LGCMS8P0dtX
        /uS6xMCAES0l8U1aeralbnYMk93xwnyIokC2DzXLePsI9ZJmTOsOh6hnk+jq057T
        xitP2+agfztLnaI4rRifnLKB+U4sfRMeW6XX/BkCgYBKJgkRWsdCCVz3ord6SzOr
        ZSPTks8Dtpxngtpc9YdcLVkx66LPdx90Tz7isovsRdwwqRCZsEvZS0Q5Q7NxIwEY
        mkvRmlJAJQIjbHWokcpVCRwlubVm6yoaJmlcxy7we+7pVpaR3BFRT4JQ4jZADAhA
        NR2H9PDc3xo66N1nWwpMyQKBgCv/ntqIHaSITbTbmPjNUl3654hFwkJxkhg02V5Q
        Ju4ayPbOl2IfmLLGaa+IlZeFuSNM/8XJ1YVurQabfib3Fb2/qxJ4d+69zPk8es/a
        Fv+kpquAB4onc9bvUyT4J9BBVi/EZPraIV3bH3DGu7H9wCQIL2fRPaWO3WezJVWk
        Yr1JAoGAGwA/Dtl6YO829BuASC1M3kQBhvMcC/RjACKPqRXvZeJWXycSjGcVluHP
        0WNEfySDHthWZND7XF1pZlJLJi7M8gfqRzUc0awOMRcxFlyrPSIosxI+AAhE7Zz8
        Yc0yRv1w+ej6bBnyg8MBI7rvsCNm2vrIP/4uOeCalQ2ucPZWQdU=
        -----END RSA PRIVATE KEY-----
      chef-server-user-key: *rsakey
      git_deploykey: *rsakey
  expected:
    resources:
      count: 13
      service:
        lb:
          count: 1
          type: load-balancer
        'magento':
          count: 3
          type1: compute
          type2: application
        'magento-worker':
          count: 9
          type1: compute
          type2: application
      '0':
        "status": "ACTIVE"
        "index": "0"
        "hosted_on": "1"
        "service": "magento-worker"
        "provider": "chef-server"
        "component": "magentostack-worker"
        "relations":
          "database:mysql-8":
            "name": "database:mysql"
            "state": "planned"
            "requires-key": "database:mysql"
            "relation": "reference"
            "interface": "mysql"
            "target": "8"
          "lb-magento-worker-http-9":
            "name": "lb-magento-worker-http"
            "source": "9"
            "state": "planned"
            "relation": "reference"
            "provides-key": "application:http"
            "relation-key": "lb-magento-worker-http"
            "interface": "http"
          "host":
            "name": "host:linux"
            "state": "planned"
            "requires-key": "host:linux"
            "relation": "host"
            "interface": "linux"
            "target": "1"
          "database:mysql-2":
            "name": "database:mysql"
            "state": "planned"
            "requires-key": "database:mysql"
            "relation": "reference"
            "interface": "mysql"
            "target": "2"
          "database:mysql-5":
            "name": "database:mysql"
            "state": "planned"
            "requires-key": "database:mysql"
            "relation": "reference"
            "interface": "mysql"
            "target": "5"
        "dns-name": "magento-worker01.magento.cldsrvr.com"
        "instance":
          "status": "ACTIVE"
          "interfaces":
            "magento":
              "username": "MagentoAdmin"
              "encryption_key": =verify(exists=True)
            "mysql":
              "magento":
                "username": "magentouser"
                "encryption_key": =verify(exists=True)
        "desired-state":
          "run_list":
            "recipes":
              - "platformstack"
              - "platformstack::rackops_rolebook"
              - "magentostack::apache-fpm"
              - "magentostack::magento_install"
              - "magentostack::newrelic"
              - "magentostack::_find_mysql"
              - "magentostack::magento_configure"
              - "magentostack::nfs_client"
              - "elkstack::java"
              - "elkstack::agent"
        "type": "application"
      "1":
        "status": "ACTIVE"
        "index": "1"
        "service": "magento-worker"
        "provider": "nova"
        "component": "linux_instance"
        "dns-name": "magento-worker01.magento.cldsrvr.com"
        "instance":
          "status": "ACTIVE"
          "error-message": ""
          "ip": "4.4.4.1"
          "image": "6b025595-a83b-436b-b37d-d5b212b5ddfc"
          "public_ip": "4.4.4.1"
          "status-message": ""
          "private_ip": "10.1.2.1"
          "flavor": "compute1-8"
          "id": "1001"
          "addresses":
            "public":
                - "version": 4
                  "addr": "4.4.4.1"
                - "version": 6
                  "addr": "2001:babe::ff04:36c1"
            "private":
                - "version": 4
                  "addr": "10.1.2.1"
        "hosts":
          - "0"
        "desired-state":
          "status": "ACTIVE"
          "os-type": "linux"
          "region": "IAD"
          "boot_from_image": true
          "image-info":
            "type": "linux"
            "os": "Centos 6.6"
            "name": "CentOS 6 (PVHVM)"
            "constraints":
              "vm_mode": "hvm"
              "auto_disk_config": "disabled"
              "flavor_classes": "*,!onmetal"
          "flavor": "compute1-8"
          "disk": 50
          "os": "Centos 6.6"
          "image": "6b025595-a83b-436b-b37d-d5b212b5ddfc"
          "flavor-info":
            "name": "7.5 GB Compute v1"
            "extra":
              "number_of_data_disks": "0"
              "class": "compute1"
              "disk_io_index": "-1"
              "policy_class": "compute_flavor"
            "memory": 7680
            "cores": 4
            "disk": 0
            "network": 625
        "type": "compute"
      "2":
        "status": "NEW"
        "index": "2"
        "service": "magento-worker"
        "provider": "chef-server"
        "component": "magentomysqlmaster"
        "dns-name": "magento-worker01.checkmate.local"
        "desired-state":
          "run_list":
            "recipes":
              - "platformstack"
              - "platformstack::rackops_rolebook"
              - "magentostack::mysql_master"
              - "magentostack::mysql_holland"
              - "elkstack::java"
              - "elkstack::agent"
        "type": "database"
      "3":
        "status": "ACTIVE"
        "index": "3"
        "hosted_on": "4"
        "service": "magento-worker"
        "provider": "chef-server"
        "component": "magentostack-worker"
        "relations":
          "database:mysql-8":
            "name": "database:mysql"
            "state": "planned"
            "requires-key": "database:mysql"
            "relation": "reference"
            "interface": "mysql"
            "target": "8"
          "lb-magento-worker-http-9":
            "name": "lb-magento-worker-http"
            "source": "9"
            "state": "planned"
            "relation": "reference"
            "provides-key": "application:http"
            "relation-key": "lb-magento-worker-http"
            "interface": "http"
          "host":
            "name": "host:linux"
            "state": "planned"
            "requires-key": "host:linux"
            "relation": "host"
            "interface": "linux"
            "target": "4"
          "database:mysql-2":
            "name": "database:mysql"
            "state": "planned"
            "requires-key": "database:mysql"
            "relation": "reference"
            "interface": "mysql"
            "target": "2"
          "database:mysql-5":
            "name": "database:mysql"
            "state": "planned"
            "requires-key": "database:mysql"
            "relation": "reference"
            "interface": "mysql"
            "target": "5"
        "dns-name": "magento-worker02.magento.cldsrvr.com"
        "instance":
          "status": "ACTIVE"
          "interfaces":
            "magento":
              "username": "MagentoAdmin"
              "encryption_key": =verify(exists=True)
            "mysql":
              "magento":
                "username": "magentouser"
                "encryption_key": =verify(exists=True)
        "desired-state":
          "run_list":
            "recipes":
              - "platformstack"
              - "platformstack::rackops_rolebook"
              - "magentostack::apache-fpm"
              - "magentostack::magento_install"
              - "magentostack::newrelic"
              - "magentostack::_find_mysql"
              - "magentostack::magento_configure"
              - "magentostack::nfs_client"
              - "elkstack::java"
              - "elkstack::agent"
        "type": "application"
      "4":
        "status": "ACTIVE"
        "index": "4"
        "service": "magento-worker"
        "provider": "nova"
        "component": "linux_instance"
        "dns-name": "magento-worker02.magento.cldsrvr.com"
        "instance":
          "status": "ACTIVE"
          "error-message": ""
          "ip": "4.4.4.4"
          "image": "6b025595-a83b-436b-b37d-d5b212b5ddfc"
          "public_ip": "4.4.4.4"
          "status-message": ""
          "private_ip": "10.1.2.4"
          "flavor": "compute1-8"
          "id": "1004"
          "addresses":
            "public":
              - "version": 4
                "addr": "4.4.4.4"
              - "version": 6
                "addr": "2001:babe::ff04:36c4"
            "private":
              - "version": 4
                "addr": "10.1.2.4"
        "hosts":
          - "3"
        "desired-state":
          "status": "ACTIVE"
          "os-type": "linux"
          "region": "IAD"
          "boot_from_image": true
          "image-info":
            "type": "linux"
            "os": "Centos 6.6"
            "name": "CentOS 6 (PVHVM)"
            "constraints":
              "vm_mode": "hvm"
              "auto_disk_config": "disabled"
              "flavor_classes": "*,!onmetal"
          "flavor": "compute1-8"
          "disk": 50
          "os": "Centos 6.6"
          "image": "6b025595-a83b-436b-b37d-d5b212b5ddfc"
          "flavor-info":
            "name": "7.5 GB Compute v1"
            "extra":
              "number_of_data_disks": "0"
              "class": "compute1"
              "disk_io_index": "-1"
              "policy_class": "compute_flavor"
            "memory": 7680
            "cores": 4
            "disk": 0
            "network": 625
        "type": "compute"
      "5":
        "status": "NEW"
        "index": "5"
        "service": "magento-worker"
        "provider": "chef-server"
        "component": "magentomysqlmaster"
        "dns-name": "magento-worker02.checkmate.local"
        "desired-state":
          "run_list":
            "recipes":
              - "platformstack"
              - "platformstack::rackops_rolebook"
              - "magentostack::mysql_master"
              - "magentostack::mysql_holland"
              - "elkstack::java"
              - "elkstack::agent"
        "type": "database"
      "6":
        "status": "ACTIVE"
        "index": "6"
        "hosted_on": "7"
        "service": "magento-worker"
        "provider": "chef-server"
        "component": "magentostack-worker"
        "relations":
          "database:mysql-8":
            "name": "database:mysql"
            "state": "planned"
            "requires-key": "database:mysql"
            "relation": "reference"
            "interface": "mysql"
            "target": "8"
          "lb-magento-worker-http-9":
            "name": "lb-magento-worker-http"
            "source": "9"
            "state": "planned"
            "relation": "reference"
            "provides-key": "application:http"
            "relation-key": "lb-magento-worker-http"
            "interface": "http"
          "host":
            "name": "host:linux"
            "state": "planned"
            "requires-key": "host:linux"
            "relation": "host"
            "interface": "linux"
            "target": "7"
          "database:mysql-2":
            "name": "database:mysql"
            "state": "planned"
            "requires-key": "database:mysql"
            "relation": "reference"
            "interface": "mysql"
            "target": "2"
          "database:mysql-5":
            "name": "database:mysql"
            "state": "planned"
            "requires-key": "database:mysql"
            "relation": "reference"
            "interface": "mysql"
            "target": "5"
        "dns-name": "magento-worker03.magento.cldsrvr.com"
        "instance":
          "status": "ACTIVE"
          "interfaces":
            "magento":
              "username": "MagentoAdmin"
              "encryption_key": =verify(exists=True)
            "mysql":
              "magento":
                "username": "magentouser"
                "encryption_key": =verify(exists=True)
        "desired-state":
          "run_list":
            "recipes":
              - "platformstack"
              - "platformstack::rackops_rolebook"
              - "magentostack::apache-fpm"
              - "magentostack::magento_install"
              - "magentostack::newrelic"
              - "magentostack::_find_mysql"
              - "magentostack::magento_configure"
              - "magentostack::nfs_client"
              - "elkstack::java"
              - "elkstack::agent"
        "type": "application"
      "7":
        "status": "ACTIVE"
        "index": "7"
        "service": "magento-worker"
        "provider": "nova"
        "component": "linux_instance"
        "dns-name": "magento-worker03.magento.cldsrvr.com"
        "instance":
          "status": "ACTIVE"
          "error-message": ""
          "ip": "4.4.4.7"
          "image": "6b025595-a83b-436b-b37d-d5b212b5ddfc"
          "public_ip": "4.4.4.7"
          "status-message": ""
          "private_ip": "10.1.2.7"
          "flavor": "compute1-8"
          "id": "1007"
          "addresses":
            "public":
              - "version": 4
                "addr": "4.4.4.7"
              - "version": 6
                "addr": "2001:babe::ff04:36c7"
            "private":
              - "version": 4
                "addr": "10.1.2.7"
        "hosts":
          - "6"
        "desired-state":
          "status": "ACTIVE"
          "os-type": "linux"
          "region": "IAD"
          "boot_from_image": true
          "image-info":
            "type": "linux"
            "os": "Centos 6.6"
            "name": "CentOS 6 (PVHVM)"
            "constraints":
              "vm_mode": "hvm"
              "auto_disk_config": "disabled"
              "flavor_classes": "*,!onmetal"
          "flavor": "compute1-8"
          "disk": 50
          "os": "Centos 6.6"
          "image": "6b025595-a83b-436b-b37d-d5b212b5ddfc"
          "flavor-info":
            "name": "7.5 GB Compute v1"
            "extra":
              "number_of_data_disks": "0"
              "class": "compute1"
              "disk_io_index": "-1"
              "policy_class": "compute_flavor"
            "memory": 7680
            "cores": 4
            "disk": 0
            "network": 625
        "type": "compute"
      "8":
        "status": "NEW"
        "index": "8"
        "service": "magento-worker"
        "provider": "chef-server"
        "component": "magentomysqlmaster"
        "dns-name": "magento-worker03.checkmate.local"
        "desired-state":
          "run_list":
            "recipes":
              - "platformstack"
              - "platformstack::rackops_rolebook"
              - "magentostack::mysql_master"
              - "magentostack::mysql_holland"
              - "elkstack::java"
              - "elkstack::agent"
        "type": "database"
      "9":
        "status": "ACTIVE"
        "index": "9"
        "service": "lb"
        "provider": "load-balancer"
        "component": "rsCloudLB"
        "relations":
          "lb-magento-worker-http-0":
            "name": "lb-magento-worker-http"
            "state": "planned"
            "supports-key": "application:http"
            "relation": "reference"
            "interface": "http"
            "relation-key": "lb-magento-worker-http"
            "target": "0"
          "lb-magento-worker-http-3":
            "name": "lb-magento-worker-http"
            "state": "planned"
            "supports-key": "application:http"
            "relation": "reference"
            "interface": "http"
            "relation-key": "lb-magento-worker-http"
            "target": "3"
          "lb-magento-worker-http-6":
            "name": "lb-magento-worker-http"
            "state": "planned"
            "supports-key": "application:http"
            "relation": "reference"
            "interface": "http"
            "relation-key": "lb-magento-worker-http"
            "target": "6"
          "lb-magento-http-10":
            "name": "lb-magento-http"
            "state": "planned"
            "supports-key": "application:http"
            "relation": "reference"
            "interface": "http"
            "relation-key": "lb-magento-http"
            "target": "10"
        "dns-name": "lb01.magento.cldsrvr.com"
        "instance":
          "status": "ACTIVE"
          "protocol": "HTTP"
          "region": "IAD"
          "port": 80
          "public_ip": "4.4.4.20"
          "status-message": ""
          "interfaces":
            "vip":
              "public_ip": "4.4.4.20"
              "ip": "4.4.4.20"
          "id": "LB1"
        "desired-state":
          "region": "IAD"
          "protocol": "http"
        "type": "load-balancer"
      "10":
        "status": "ACTIVE"
        "index": "10"
        "hosted_on": "11"
        "service": "magento"
        "provider": "chef-server"
        "component": "magentostack"
        "relations":
          "lb-magento-http-9":
            "name": "lb-magento-http"
            "source": "9"
            "state": "planned"
            "relation": "reference"
            "provides-key": "application:http"
            "relation-key": "lb-magento-http"
            "interface": "http"
          "database:mysql-12":
            "name": "database:mysql"
            "state": "planned"
            "requires-key": "database:mysql"
            "relation": "reference"
            "interface": "mysql"
            "target": "12"
          "host":
            "name": "host:linux"
            "state": "planned"
            "requires-key": "host:linux"
            "relation": "host"
            "interface": "linux"
            "target": "11"
        "dns-name": "magento.magento.cldsrvr.com"
        "instance":
          "status": "ACTIVE"
          "interfaces":
            "magento":
              "username": "MagentoAdmin"
              "encryption_key": =verify(exists=True)
            "mysql":
              "magento":
                "username": "magentouser"
                "encryption_key": =verify(exists=True)
        "desired-state":
          "run_list":
            "recipes":
              - "platformstack"
              - "platformstack::rackops_rolebook"
              - "magentostack::apache-fpm"
              - "magentostack::magento_install"
              - "magentostack::newrelic"
              - "magentostack::_find_mysql"
              - "magentostack::magento_configure"
              - "magentostack::magento_admin"
              - "magentostack::nfs_client"
              - "elkstack::java"
              - "elkstack::agent"
        "type": "application"
      "11":
        "status": "ACTIVE"
        "index": "11"
        "service": "magento"
        "provider": "nova"
        "component": "linux_instance"
        "dns-name": "magento.magento.cldsrvr.com"
        "instance":
          "status": "ACTIVE"
          "error-message": ""
          "ip": "4.4.4.11"
          "image": "6b025595-a83b-436b-b37d-d5b212b5ddfc"
          "public_ip": "4.4.4.11"
          "status-message": ""
          "private_ip": "10.1.2.11"
          "flavor": "compute1-8"
          "id": "1011"
          "addresses":
            "public":
              - "version": 4
                "addr": "4.4.4.11"
              - "version": 6
                "addr": "2001:babe::ff04:36c11"
            "private":
              - "version": 4
                "addr": "10.1.2.11"
        "hosts":
          - "10"
        "desired-state":
          "status": "ACTIVE"
          "os-type": "linux"
          "region": "IAD"
          "boot_from_image": true
          "image-info":
            "type": "linux"
            "os": "Centos 6.6"
            "name": "CentOS 6 (PVHVM)"
            "constraints":
              "vm_mode": "hvm"
              "auto_disk_config": "disabled"
              "flavor_classes": "*,!onmetal"
          "flavor": "compute1-8"
          "disk": 50
          "os": "Centos 6.6"
          "image": "6b025595-a83b-436b-b37d-d5b212b5ddfc"
          "flavor-info":
            "name": "7.5 GB Compute v1"
            "extra":
              "number_of_data_disks": "0"
              "class": "compute1"
              "disk_io_index": "-1"
              "policy_class": "compute_flavor"
            "memory": 7680
            "cores": 4
            "disk": 0
            "network": 625
        "type": "compute"
      "12":
        "status": "NEW"
        "index": "12"
        "service": "magento"
        "provider": "chef-server"
        "component": "magentomysqlmaster"
        "dns-name": "magento.checkmate.local"
        "desired-state":
          "run_list":
            "recipes":
              - "platformstack"
              - "platformstack::rackops_rolebook"
              - "magentostack::mysql_master"
              - "magentostack::mysql_holland"
              - "elkstack::java"
              - "elkstack::agent"
        "type": "database"
      "kibana user":
        "instance":
          "password": =verify(exists=True)
          "name": "KibanaAdmin"
        "type": "user"
        "index": "kibana user"
      "magento user":
        "instance":
          "password": =verify(exists=True)
          "name": "MagentoAdmin"
        "type": "user"
        "index": "magento user"
      "deployment-keys":
        "instance":
          "public_key": =verify(exists=True)
          "private_key": =verify(exists=True)
          "public_key_ssh": =verify(exists=True)
        "type": "key-pair"
      "db user":
        "instance":
          "password": =verify(exists=True)
          "name": "magentouser"
        "type": "user"
        "index": "db user"
      "root":
        "instance":
          "password": =verify(exists=True)
          "name": "admin"
        "type": "user"
        "index": "root"
- name: Extra Small deployment
  flavor: extra-small
  inputs: *inputs
  expected:
    resources:
      count: 15
      service:
        'all-redis':
          count: 2
          type1: compute
          type2: cache
        'db-master':
          count: 2
          type1: compute
          type2: database
        'utility':
          count: 2
          type1: compute
          type2: logging
        'lb':
          count: 1
          type: load-balancer
        'magento-worker':
          count: 6
          type1: compute
          type2: application
        'magento':
          count: 2
          type1: compute
          type2: application
      '4':
        desired-state:
          flavor: compute1-15
        instance:
          flavor: compute1-15
      '6':
        desired-state:
          flavor: compute1-15
        instance:
          flavor: compute1-15
      '8':
        desired-state:
          flavor: compute1-15
        instance:
          flavor: compute1-15
      '10':
        desired-state:
          flavor: compute1-15
        instance:
          flavor: compute1-15
- name: Small deployment
  flavor: small
  inputs: *inputs
  expected:
    resources:
      count: 18
      service:
        'all-redis':
          count: 2
          type1: compute
          type2: cache
        'db-master':
          count: 2
          type1: compute
          type2: database
        'logs':
          count: 2
          type1: compute
          type2: logging
        'shared-storage':
          count: 3
          type1: compute
          type2: volume
          type3: volume
        'lb':
          count: 1
          type: load-balancer
        'magento-worker':
          count: 6
          type1: compute
          type2: application
        'magento':
          count: 2
          type1: compute
          type2: application
      '6':
        desired-state:
          flavor: onmetal-compute1
        instance:
          flavor: onmetal-compute1
      '8':
        desired-state:
          flavor: onmetal-compute1
        instance:
          flavor: onmetal-compute1
      '10':
        desired-state:
          flavor: onmetal-compute1
        instance:
          flavor: onmetal-compute1
      '12':
        desired-state:
          flavor: onmetal-compute1
        instance:
          flavor: onmetal-compute1
- name: Medium deployment
  flavor: medium
  inputs: *inputs
  expected:
    resources:
      count: 22
      service:
        'object-cache':
          count: 1
          type: cache
        'page-cache':
          count: 1
          type: cache
        'session-cache':
          count: 1
          type: cache
        'db-master':
          count: 2
          type1: compute
          type2: database
        'db-replica':
          count: 2
          type1: compute
          type2: database-replica
        'logs':
          count: 3
          type1: compute
          type2: logging
          type3: volume
        'shared-storage':
          count: 3
          type1: compute
          type2: volume
          type3: volume
        'lb':
          count: 1
          type: load-balancer
        'magento-worker':
          count: 6
          type1: compute
          type2: application
        'magento':
          count: 2
          type1: compute
          type2: application
      '10':
        desired-state:
          flavor: compute1-15
        instance:
          flavor: compute1-15
      '15':
        desired-state:
          flavor: compute1-15
        instance:
          flavor: compute1-15
      '17':
        desired-state:
          flavor: compute1-15
        instance:
          flavor: compute1-15
      '19':
        desired-state:
          flavor: compute1-15
        instance:
          flavor: compute1-15
- name: Large deployment
  flavor: large
  inputs: *inputs
  expected:
    resources:
      count: 22
      service:
        'object-cache':
          count: 1
          type: cache
        'page-cache':
          count: 1
          type: cache
        'session-cache':
          count: 1
          type: cache
        'db-master':
          count: 2
          type1: compute
          type2: database
        'db-replica':
          count: 2
          type1: compute
          type2: database-replica
        'logs':
          count: 3
          type1: compute
          type2: logging
          type3: volume
        'shared-storage':
          count: 3
          type1: compute
          type2: volume
          type3: volume
        'lb':
          count: 1
          type: load-balancer
        'magento-worker':
          count: 6
          type1: compute
          type2: application
        'magento':
          count: 2
          type1: compute
          type2: application
      '10':
        desired-state:
          flavor: onmetal-compute1
        instance:
          flavor: onmetal-compute1
      '15':
        desired-state:
          flavor: onmetal-compute1
        instance:
          flavor: onmetal-compute1
      '17':
        desired-state:
          flavor: onmetal-compute1
        instance:
          flavor: onmetal-compute1
      '19':
        desired-state:
          flavor: onmetal-compute1
        instance:
          flavor: onmetal-compute1
